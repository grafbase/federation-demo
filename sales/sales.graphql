extend schema
    @link(
        url: "https://specs.grafbase.com/composite-schemas/v1"
        import: ["@lookup", "@key", "@derive"]
    )
    @link(url: "https://specs.apollo.dev/federation/v2.5")
    @link(
        url: "https://extensions.grafbase.com/extensions/nats/0.5.1"
        import: ["@natsPublish", "@natsSubscription"]
    ) {
    subscription: Subscription
}

input SellProductInput {
    productId: ID!
    price: Int!
}

type Mutation {
    sellProduct(input: SellProductInput!): Boolean!
        @natsPublish(subject: "productSales", body: { selection: "." })
}

type ProductSale {
    productId: ID!
    product: Product! @derive
    price: Int!
}

type Product @key(fields: "id") {
    id: ID!
}

type Subscription {
    sales(subject: String!): ProductSale
        @natsSubscription(
            subject: "{{ args.subject }}"
            selection: "select(.price > 10)"
        )
}
